"use strict";
///<reference path="./typings/index.d.ts"/>
var express = require("express");
var fs = require("fs");
var path = require("path");
var bodyParser = require("body-parser");
;
var rootPath = '.';
var app = express();
var dirs = fs.readdirSync(rootPath).filter(function (file) {
    return fs.statSync(path.join(rootPath, file)).isDirectory();
});
app.use(bodyParser.json());
var funcDirs = dirs.filter(function (dir) {
    var filePath = path.join(rootPath, dir, 'function.json');
    return fs.existsSync(filePath);
});
var funcs = {};
funcDirs.forEach(function (funcDir) {
    funcs[funcDir] = require("./" + funcDir + "/index").default;
});
funcDirs.forEach(function (funcDir) {
    var route = "/api/" + funcDir;
    console.log("route = " + route);
    app.post(route, function (req, res) {
        var handler = funcs[funcDir];
        if (handler) {
            handler({ res: res, log: console.log, done: function () {
                    res.sendStatus(202);
                    res.end();
                } }, req);
        }
        else {
            res.send(404, "handler " + funcDir + " not defined");
            res.end();
        }
    });
});
var port = process.env['NODE_PORT'] || 3000;
app.listen(port, function () {
    console.log("function now hosted at http://localhost:" + port);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlYnVnLWhvc3QvZGVidWctaG9zdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMkNBQTJDO0FBQzNDLElBQVksT0FBTyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBQ25DLElBQVksRUFBRSxXQUFNLElBQUksQ0FBQyxDQUFBO0FBQ3pCLElBQVksSUFBSSxXQUFNLE1BQU0sQ0FBQyxDQUFBO0FBQzdCLElBQVksVUFBVSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBTXpDLENBQUM7QUFNRixJQUFNLFFBQVEsR0FBRyxHQUFHLENBQUM7QUFDckIsSUFBSSxHQUFHLEdBQUcsT0FBTyxFQUFFLENBQUM7QUFDcEIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJO0lBQzdDLE9BQUEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRTtBQUFwRCxDQUFvRCxDQUNyRCxDQUFDO0FBRUYsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUUzQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUEsR0FBRztJQUM1QixJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsZUFBZSxDQUFDLENBQUE7SUFDMUQsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsQ0FBQyxDQUFDLENBQUM7QUFHSCxJQUFJLEtBQUssR0FBc0MsRUFBRSxDQUFDO0FBRWxELFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxPQUFPO0lBQ3RCLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBSyxPQUFPLFdBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUN6RCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxPQUFPO0lBQ3RCLElBQU0sS0FBSyxHQUFHLFVBQVEsT0FBUyxDQUFDO0lBQ2hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBVyxLQUFPLENBQUMsQ0FBQztJQUNoQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFDLEdBQUcsRUFBRSxHQUFHO1FBQ3ZCLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMvQixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1osT0FBTyxDQUFDLEVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUU7b0JBQ3pDLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3BCLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDWixDQUFDLEVBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNYLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLGFBQVcsT0FBTyxpQkFBYyxDQUFDLENBQUM7WUFDaEQsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ1osQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLElBQUksQ0FBQztBQUM5QyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtJQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkNBQTJDLElBQU0sQ0FBQyxDQUFDO0FBQ2pFLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImRlYnVnLWhvc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cclxuaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xyXG5pbXBvcnQgKiBhcyBib2R5UGFyc2VyIGZyb20gXCJib2R5LXBhcnNlclwiO1xyXG5cclxuaW50ZXJmYWNlIEZ1bmN0aW9uQ29udGV4dCB7XHJcbiAgcmVzOiBhbnk7XHJcbiAgbG9nKG1zZzogc3RyaW5nLCAuLi5hcmdzOmFueVtdKSA6IHZvaWQ7XHJcbiAgZG9uZSgpIDogdm9pZDtcclxufTtcclxuXHJcbmludGVyZmFjZSBGdW5jaXRvbkhhbmRsZXIge1xyXG4gIChjb250ZXh0OiBGdW5jdGlvbkNvbnRleHQsIHJlcTogYW55KSA6IHZvaWQ7XHJcbn1cclxuXHJcbmNvbnN0IHJvb3RQYXRoID0gJy4nO1xyXG5sZXQgYXBwID0gZXhwcmVzcygpO1xyXG5sZXQgZGlycyA9IGZzLnJlYWRkaXJTeW5jKHJvb3RQYXRoKS5maWx0ZXIoZmlsZSA9PlxyXG4gIGZzLnN0YXRTeW5jKHBhdGguam9pbihyb290UGF0aCwgZmlsZSkpLmlzRGlyZWN0b3J5KClcclxuKTtcclxuXHJcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xyXG5cclxubGV0IGZ1bmNEaXJzID0gZGlycy5maWx0ZXIoZGlyID0+IHtcclxuICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihyb290UGF0aCwgZGlyLCAnZnVuY3Rpb24uanNvbicpXHJcbiAgcmV0dXJuIGZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpO1xyXG59KTtcclxuXHJcblxyXG5sZXQgZnVuY3M6IHtbbmFtZTpzdHJpbmddIDogRnVuY2l0b25IYW5kbGVyfSA9IHt9O1xyXG5cclxuZnVuY0RpcnMuZm9yRWFjaChmdW5jRGlyID0+IHtcclxuICBmdW5jc1tmdW5jRGlyXSA9IHJlcXVpcmUoYC4vJHtmdW5jRGlyfS9pbmRleGApLmRlZmF1bHQ7XHJcbn0pO1xyXG5cclxuZnVuY0RpcnMuZm9yRWFjaChmdW5jRGlyID0+IHtcclxuICBjb25zdCByb3V0ZSA9IGAvYXBpLyR7ZnVuY0Rpcn1gO1xyXG4gIGNvbnNvbGUubG9nKGByb3V0ZSA9ICR7cm91dGV9YCk7XHJcbiAgYXBwLnBvc3Qocm91dGUsIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgaGFuZGxlciA9IGZ1bmNzW2Z1bmNEaXJdO1xyXG4gICAgaWYgKGhhbmRsZXIpIHtcclxuICAgICAgaGFuZGxlcih7cmVzOiByZXMsIGxvZzogY29uc29sZS5sb2csIGRvbmU6ICgpID0+IHtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cygyMDIpO1xyXG4gICAgICAgIHJlcy5lbmQoKTsgICAgICAgIFxyXG4gICAgICB9fSwgcmVxKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlcy5zZW5kKDQwNCwgYGhhbmRsZXIgJHtmdW5jRGlyfSBub3QgZGVmaW5lZGApO1xyXG4gICAgICByZXMuZW5kKCk7XHJcbiAgICB9XHJcbiAgfSlcclxufSk7XHJcblxyXG5jb25zdCBwb3J0ID0gcHJvY2Vzcy5lbnZbJ05PREVfUE9SVCddIHx8IDMwMDA7XHJcbmFwcC5saXN0ZW4ocG9ydCwgKCkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKGBmdW5jdGlvbiBub3cgaG9zdGVkIGF0IGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWApO1xyXG59KTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
